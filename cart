import 'package:flutter/material.dart';

void main() => runApp(const MyApp());

// -------------------- MAIN APP --------------------
class MyApp extends StatelessWidget {
  const MyApp({super.key});
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      debugShowCheckedModeBanner: false,
      title: 'DartPad Shop',
      theme: ThemeData(
        primarySwatch: Colors.teal,
        brightness: Brightness.light,
      ),
      initialRoute: '/',
      routes: {
        '/': (_) => const HomePage(),
        '/cart': (_) => const CartPage(),
      },
    );
  }
}

// -------------------- PRODUCT MODEL --------------------
class Product {
  final String name;
  final double price;
  Product(this.name, this.price);
}

// -------------------- HOME PAGE --------------------
class HomePage extends StatefulWidget {
  const HomePage({super.key});
  @override
  State<HomePage> createState() => _HomePageState();
}

class _HomePageState extends State<HomePage> {
  final List<Product> products = [
    Product("Shoes", 1200),
    Product("Watch", 2500),
    Product("T-Shirt", 700),
    Product("Bag", 1500),
  ];

  final List<Product> cart = [];

  double opacityLevel = 0.0;

  @override
  void initState() {
    super.initState();
    Future.delayed(const Duration(milliseconds: 100), () {
      setState(() => opacityLevel = 1.0);
    });
  }

  @override
  Widget build(BuildContext context) {
    final crossCount = MediaQuery.of(context).size.width > 600 ? 3 : 2;

    return Scaffold(
      appBar: AppBar(
        title: const Text('Simple Shop'),
        actions: [
          GestureDetector(
            onTap: () => Navigator.push(context,
                MaterialPageRoute(builder: (_) => CartPage(cart: cart))),
            child: Padding(
              padding: const EdgeInsets.all(16),
              child: Stack(
                children: [
                  const Icon(Icons.shopping_cart),
                  if (cart.isNotEmpty)
                    Positioned(
                      right: 0,
                      child: CircleAvatar(
                        radius: 8,
                        backgroundColor: Colors.red,
                        child: Text(
                          cart.length.toString(),
                          style: const TextStyle(
                              fontSize: 10, color: Colors.white),
                        ),
                      ),
                    )
                ],
              ),
            ),
          )
        ],
      ),
      body: AnimatedOpacity(
        opacity: opacityLevel,
        duration: const Duration(milliseconds: 500),
        child: GridView.builder(
          padding: const EdgeInsets.all(10),
          gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
              crossAxisCount: crossCount,
              crossAxisSpacing: 10,
              mainAxisSpacing: 10),
          itemCount: products.length,
          itemBuilder: (context, index) {
            return ProductCard(
              product: products[index],
              onAdd: () => setState(() => cart.add(products[index])),
              onView: () => Navigator.push(
                  context,
                  MaterialPageRoute(
                      builder: (_) =>
                          ProductDetailsPage(product: products[index]))),
            );
          },
        ),
      ),
    );
  }
}

// -------------------- PRODUCT CARD --------------------
class ProductCard extends StatelessWidget {
  final Product product;
  final VoidCallback onAdd;
  final VoidCallback onView;
  const ProductCard(
      {super.key,
      required this.product,
      required this.onAdd,
      required this.onView});

  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onTap: onView,
      child: Card(
        elevation: 4,
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Text(product.name,
                style:
                    const TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
            const SizedBox(height: 6),
            Text('₹${product.price.toStringAsFixed(2)}',
                style: const TextStyle(fontSize: 16)),
            const SizedBox(height: 10),
            ElevatedButton(onPressed: onAdd, child: const Text("Add to Cart")),
          ],
        ),
      ),
    );
  }
}

// -------------------- PRODUCT DETAILS PAGE --------------------
class ProductDetailsPage extends StatelessWidget {
  final Product product;
  const ProductDetailsPage({super.key, required this.product});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text(product.name)),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Text(product.name, style: const TextStyle(fontSize: 28)),
            const SizedBox(height: 10),
            Text('Price: ₹${product.price.toStringAsFixed(2)}',
                style: const TextStyle(fontSize: 22)),
            const SizedBox(height: 20),
            ElevatedButton(
                onPressed: () {
                  ScaffoldMessenger.of(context).showSnackBar(
                      const SnackBar(content: Text("Item added to cart")));
                },
                child: const Text('Add to Cart'))
          ],
        ),
      ),
    );
  }
}

// -------------------- CART PAGE --------------------
class CartPage extends StatelessWidget {
  final List<Product> cart;
  const CartPage({super.key, this.cart = const []});

  @override
  Widget build(BuildContext context) {
    double total = cart.fold(0, (sum, p) => sum + p.price);
    return Scaffold(
      appBar: AppBar(title: const Text("Cart")),
      body: cart.isEmpty
          ? const Center(child: Text("Cart is Empty"))
          : Column(
              children: [
                Expanded(
                  child: ListView.builder(
                      itemCount: cart.length,
                      itemBuilder: (_, i) {
                        final p = cart[i];
                        return ListTile(
                          title: Text(p.name),
                          trailing: Text('₹${p.price.toStringAsFixed(2)}'),
                        );
                      }),
                ),
                Padding(
                  padding: const EdgeInsets.all(12),
                  child: Text('Total: ₹${total.toStringAsFixed(2)}',
                      style: const TextStyle(
                          fontSize: 20, fontWeight: FontWeight.bold)),
                )
              ],
            ),
    );
  }
}
